<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Chen's Journal - The Lost Observatory</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e);
            color: #00ff88;
            font-family: 'Roboto Mono', monospace;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 15px #00ff88;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: #88ffaa;
            font-size: 1.1rem;
        }
        
        .puzzle-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 2rem;
        }
        
        .journal-section {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 2rem;
        }
        
        .journal-header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #00ff88;
            padding-bottom: 1rem;
        }
        
        .journal-date {
            color: #88ffaa;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .research-notes {
            background: rgba(255, 255, 136, 0.1);
            border-left: 4px solid #ffff88;
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .encrypted-journal {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff6464;
            border-radius: 10px;
            padding: 2rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            line-height: 1.8;
            color: #ff6464;
            margin-bottom: 2rem;
            letter-spacing: 2px;
        }
        
        .cipher-station {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 2rem;
        }
        
        .multi-cipher-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #00ff88;
        }
        
        .cipher-tab {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #666;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            margin-right: 0.5rem;
        }
        
        .cipher-tab.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            color: #00ff88;
        }
        
        .cipher-tool {
            display: none;
            margin-bottom: 2rem;
        }
        
        .cipher-tool.active {
            display: block;
        }
        
        .frequency-analysis {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .letter-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .letter-count {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff88;
            padding: 0.5rem;
            text-align: center;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
        }
        
        .substitution-grid {
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            gap: 0.3rem;
            margin: 1rem 0;
        }
        
        .sub-box {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff88;
            padding: 0.3rem;
            text-align: center;
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
        }
        
        .sub-input {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff6464;
            color: #ff6464;
            text-align: center;
            width: 100%;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
            padding: 0.2rem;
        }
        
        .keyword-input {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff88;
            border-radius: 5px;
            padding: 1rem;
            color: #00ff88;
            font-family: 'Roboto Mono', monospace;
            width: 100%;
            font-size: 1.1rem;
            text-align: center;
            margin: 1rem 0;
        }
        
        .decoder-workspace {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .workspace-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff88;
            border-radius: 8px;
            padding: 1rem;
            color: #00ff88;
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            min-height: 200px;
        }
        
        .hint-box {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid #ffff00;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            color: #ffff88;
        }
        
        .challenge-box {
            background: rgba(255, 100, 100, 0.1);
            border: 2px solid #ff6464;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            color: #ff6464;
        }
        
        .btn {
            background: linear-gradient(45deg, #00ff88, #88ffaa);
            color: #000;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 255, 136, 0.4);
        }
        
        .btn.secondary {
            background: linear-gradient(45deg, #666, #888);
        }
        
        .btn.danger {
            background: linear-gradient(45deg, #ff6464, #ffaaaa);
        }
        
        .result-message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .success {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
        }
        
        .error {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid #ff6464;
            color: #ff6464;
        }
        
        .pattern-highlight {
            background: rgba(255, 255, 136, 0.3);
            color: #ffff00;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .time-reveal {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            color: #ff6464;
            text-shadow: 0 0 10px #ff6464;
            text-align: center;
            margin: 2rem 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @media (max-width: 768px) {
            .puzzle-layout {
                grid-template-columns: 1fr;
            }
            
            .substitution-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .multi-cipher-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">📜 DR. CHEN'S ENCRYPTED JOURNAL</h1>
            <p class="subtitle">Advanced Cryptographic Analysis Required</p>
        </div>
        
        <div class="puzzle-layout">
            <div class="journal-section">
                <div class="journal-header">
                    <div class="journal-date">Research Log Entry #2847</div>
                    <div class="journal-date">November 15, 1987 - [REDACTED]</div>
                    <h3>CLASSIFIED - COSMIC ALIGNMENT PROJECT</h3>
                </div>
                
                <div class="research-notes">
                    <div class="journal-date">Pre-encryption notes found in margins:</div>
                    <p><strong>Cipher Method:</strong> "Multi-layered encryption using astronomical keywords. The constellation holds the first key, the planet count shifts the alphabet."</p>
                    <p><strong>Security Note:</strong> "Only someone who understands our previous discoveries can decode this. The time itself is encoded within."</p>
                </div>
                
                <div class="challenge-box">
                    <h4>🔒 CRYPTOGRAPHIC CHALLENGE</h4>
                    <p>Dr. Chen used a sophisticated multi-cipher system. The message below requires:</p>
                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li><strong>Keyword Substitution</strong> using an astronomical term</li>
                        <li><strong>Caesar Shift</strong> based on planetary count</li>
                        <li><strong>Pattern Recognition</strong> to extract the final time</li>
                    </ol>
                </div>
                
                <div class="encrypted-journal" id="encrypted-journal">
PDIJLW KZNL HFJBQ HL QBWQZ MJKZ MJKZBK SZNM<br>
KQ PDL QFJDP KM BFIWKZLNZ<br><br>

HLNFBFHQ WPHRFKQ DKQVL PDL FLZL<br>
PK PDL WKERFW JHPLTHR<br><br>

TDLQ KNFKQ NFELL HP EFBQFJDP<br>
PDL RHPD KMLQL PK FQMFQFPZ<br><br>

PDFK FE EZ MQHJ ELLHJL HP<br>
<span class="pattern-highlight">PTLQPZ PDNLL MKZPZ ELHZQ</span><br>
- BN. WDLQ
                </div>
                
                <div class="hint-box">
                    <strong>🔍 Frequency Analysis Hint:</strong><br>
                    Notice the pattern in the highlighted line: "PTLQPZ PDNLL MKZPZ ELHZQ" - this appears to be encoded numbers. Look for the time Dr. Chen made her observation.
                </div>
            </div>
            
            <div class="cipher-station">
                <h3>🔧 Advanced Cryptanalysis Station</h3>
                
                <div class="multi-cipher-tabs">
                    <div class="cipher-tab active" onclick="switchTab('frequency')">Frequency</div>
                    <div class="cipher-tab" onclick="switchTab('substitution')">Substitution</div>
                    <div class="cipher-tab" onclick="switchTab('keyword')">Keyword</div>
                    <div class="cipher-tab" onclick="switchTab('caesar')">Caesar</div>
                </div>
                
                <!-- Frequency Analysis Tab -->
                <div class="cipher-tool active" id="frequency-tool">
                    <h4>Letter Frequency Analysis</h4>
                    <p>Analyze the frequency of letters in the encrypted text:</p>
                    <div class="frequency-analysis">
                        <div class="letter-grid" id="frequency-grid">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        <button class="btn" onclick="analyzeFrequency()">Analyze Frequency</button>
                    </div>
                    <div class="hint-box">
                        <strong>Tip:</strong> In English, the most common letters are E, T, A, O, I, N, S, H, R...
                    </div>
                </div>
                
                <!-- Manual Substitution Tab -->
                <div class="cipher-tool" id="substitution-tool">
                    <h4>Manual Letter Substitution</h4>
                    <p>Map encrypted letters to their plaintext equivalents:</p>
                    <div class="substitution-grid" id="substitution-grid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    <button class="btn" onclick="applySubstitution()">Apply Substitution</button>
                    <button class="btn secondary" onclick="resetSubstitution()">Reset</button>
                </div>
                
                <!-- Keyword Cipher Tab -->
                <div class="cipher-tool" id="keyword-tool">
                    <h4>Keyword Vigenère Cipher</h4>
                    <p>Enter a keyword that Dr. Chen might have used (hint: think astronomical):</p>
                    <input type="text" class="keyword-input" id="keyword-input" placeholder="Enter keyword (e.g., CONSTELLATION NAME)">
                    <button class="btn" onclick="tryKeyword()">Test Keyword</button>
                    <div class="hint-box">
                        <strong>Astronomical Keywords to Try:</strong> TELESCOPE, STELLAR, COSMIC, PLANETS
                    </div>
                </div>
                
                <!-- Caesar Cipher Tab -->
                <div class="cipher-tool" id="caesar-tool">
                    <h4>Caesar Shift Cipher</h4>
                    <p>Try different shift values (hint: astronomical numbers):</p>
                    <div style="text-align: center; margin: 1rem 0;">
                        <label>Shift Value: <span id="shift-display">1</span></label><br>
                        <input type="range" id="shift-slider" min="1" max="25" value="1" style="width: 200px; margin: 1rem;" oninput="updateCaesarShift()">
                    </div>
                    <button class="btn" onclick="applyCaesarShift()">Apply Shift</button>
                    <div class="hint-box">
                        <strong>Try These Values:</strong> 3 (traditional), 8 (planets), 13 (half alphabet), 7 (lucky number)
                    </div>
                </div>
            </div>
        </div>
        
        <div class="decoder-workspace">
            <h3>🔍 Decryption Workspace</h3>
            <p>Your decrypted text will appear here as you work:</p>
            <textarea class="workspace-input" id="workspace" placeholder="Partially decrypted text will appear here as you apply different cipher techniques..."></textarea>
            
            <div style="text-align: center; margin-top: 1rem;">
                <button class="btn" onclick="checkFinalDecryption()">Verify Complete Decryption</button>
                <button class="btn secondary" onclick="resetWorkspace()">Clear Workspace</button>
                <button class="btn secondary" onclick="window.location.href='index.html'">Return to Archive</button>
            </div>
        </div>
        
        <div id="result-message"></div>
    </div>

    <script>
        const encryptedText = `PDIJLW KZNL HFJBQ HL QBWQZ MJKZ MJKZBK SZNM
KQ PDL QFJDP KM BFIWKZLNZ

HLNFBFHQ WPHRFKQ DKQVL PDL FLZL
PK PDL WKELFW JHPLTHR

TDLQ KNFKQ NFELL HP EFBQFJDP
PDL RHPD KMLQL PK FQMFQFPZ

PDFK FE EZ MQHJ ELLHJL HP
PTLQPZ PDNLL MKZPZ ELHZQ
- BN. WDLQ`;

        const correctDecryption = `TWENTY THREE FORTY SEVEN ON THE NIGHT OF DISCOVERY

MERIDIAN STATION HOLDS THE KEYS
TO THE COSMIC GATEWAY

WHEN ORION RISES AT MIDNIGHT
THE PATH OPENS TO INFINITY

THIS IS MY FINAL MESSAGE AT
TWENTY THREE FORTY SEVEN
- DR. CHEN`;

        let currentWorkspace = '';
        
        function switchTab(tabName) {
            // Hide all tools
            document.querySelectorAll('.cipher-tool').forEach(tool => {
                tool.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.cipher-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tool and tab
            document.getElementById(tabName + '-tool').classList.add('active');
            event.target.classList.add('active');
        }
        
        function analyzeFrequency() {
            const text = encryptedText.replace(/[^A-Z]/g, '');
            const frequency = {};
            
            // Count letter frequencies
            for (let char of text) {
                frequency[char] = (frequency[char] || 0) + 1;
            }
            
            // Sort by frequency
            const sorted = Object.entries(frequency).sort((a, b) => b[1] - a[1]);
            
            const grid = document.getElementById('frequency-grid');
            grid.innerHTML = '';
            
            sorted.forEach(([letter, count]) => {
                const div = document.createElement('div');
                div.className = 'letter-count';
                div.innerHTML = `<strong>${letter}</strong><br>${count}`;
                grid.appendChild(div);
            });
        }
        
        function createSubstitutionGrid() {
            const grid = document.getElementById('substitution-grid');
            grid.innerHTML = '';
            
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            
            // Create header row
            for (let letter of alphabet) {
                const div = document.createElement('div');
                div.className = 'sub-box';
                div.textContent = letter;
                grid.appendChild(div);
            }
            
            // Create input row
            for (let letter of alphabet) {
                const input = document.createElement('input');
                input.className = 'sub-input';
                input.maxLength = 1;
                input.dataset.original = letter;
                grid.appendChild(input);
            }
        }
        
        function applySubstitution() {
            const inputs = document.querySelectorAll('.sub-input');
            let substituted = encryptedText;
            
            inputs.forEach(input => {
                if (input.value) {
                    const original = input.dataset.original;
                    const replacement = input.value.toUpperCase();
                    substituted = substituted.replace(new RegExp(original, 'g'), replacement);
                }
            });
            
            document.getElementById('workspace').value = substituted;
            currentWorkspace = substituted;
        }
        
        function resetSubstitution() {
            document.querySelectorAll('.sub-input').forEach(input => {
                input.value = '';
            });
        }
        
        function tryKeyword() {
            const keyword = document.getElementById('keyword-input').value.toUpperCase();
            if (!keyword) return;
            
            // Simple Vigenère decode attempt
            let decoded = '';
            let keyIndex = 0;
            
            for (let char of encryptedText) {
                if (/[A-Z]/.test(char)) {
                    const shift = keyword.charCodeAt(keyIndex % keyword.length) - 65;
                    const decoded_char = String.fromCharCode(((char.charCodeAt(0) - 65 - shift + 26) % 26) + 65);
                    decoded += decoded_char;
                    keyIndex++;
                } else {
                    decoded += char;
                }
            }
            
            document.getElementById('workspace').value = decoded;
            currentWorkspace = decoded;
            
            // Check if this looks like it's working
            if (decoded.includes('THE ') || decoded.includes('AND ') || decoded.includes('TWENTY')) {
                showHint("This keyword seems promising! Look for recognizable English words.");
            }
        }
        
        function updateCaesarShift() {
            const shift = document.getElementById('shift-slider').value;
            document.getElementById('shift-display').textContent = shift;
        }
        
        function applyCaesarShift() {
            const shift = parseInt(document.getElementById('shift-slider').value);
            let decoded = '';
            
            for (let char of encryptedText) {
                if (/[A-Z]/.test(char)) {
                    const decoded_char = String.fromCharCode(((char.charCodeAt(0) - 65 - shift + 26) % 26) + 65);
                    decoded += decoded_char;
                } else {
                    decoded += char;
                }
            }
            
            document.getElementById('workspace').value = decoded;
            currentWorkspace = decoded;
        }
        
        function checkFinalDecryption() {
            const workspace = document.getElementById('workspace').value.trim().toUpperCase();
            const resultDiv = document.getElementById('result-message');
            
            // Check for the key time pattern
            const hasTimePattern = workspace.includes('TWENTY THREE FORTY SEVEN') || 
                                 workspace.includes('23:47') ||
                                 workspace.includes('2347');
            
            const hasKeyWords = workspace.includes('MERIDIAN') && 
                              workspace.includes('ORION') && 
                              workspace.includes('CHEN');
            
            if (hasTimePattern && hasKeyWords) {
                resultDiv.className = 'result-message success';
                resultDiv.innerHTML = `
                    <h3>🎉 Journal Successfully Decrypted!</h3>
                    <div class="time-reveal">23:47</div>
                    <p>Excellent work! You've successfully decoded Dr. Chen's complex multi-cipher encryption.</p>
                    <p><strong>Key Evidence Found:</strong> The time <strong>23:47</strong> - this represents the exact moment of Dr. Chen's cosmic discovery.</p>
                    <p>The journal reveals that the stars aligned at exactly 23:47 on the night of her breakthrough observation.</p>
                `;
                
                // Save progress
                localStorage.setItem('cipherPuzzleSolved', 'true');
                localStorage.setItem('timeClue', '23:47');
                
            } else if (hasTimePattern) {
                resultDiv.className = 'result-message error';
                resultDiv.innerHTML = `
                    <h3>⚠️ Partially Decrypted</h3>
                    <p>You've found the time pattern, but the decryption isn't complete. Make sure all the text is properly decoded, including references to "MERIDIAN", "ORION", and "CHEN".</p>
                `;
            } else {
                resultDiv.className = 'result-message error';
                resultDiv.innerHTML = `
                    <h3>❌ Decryption Incomplete</h3>
                    <p>The journal hasn't been fully decrypted yet. Try combining multiple cipher techniques:</p>
                    <ul style="text-align: left; margin-top: 1rem;">
                        <li>Start with keyword substitution using "ORION"</li>
                        <li>Then apply a Caesar shift of 8</li>
                        <li>Look for the encoded time in the last stanza</li>
                    </ul>
                `;
            }
        }
        
        function resetWorkspace() {
            document.getElementById('workspace').value = '';
            currentWorkspace = '';
            document.getElementById('result-message').innerHTML = '';
        }
        
        function showHint(message) {
            const hint = document.createElement('div');
            hint.className = 'hint-box';
            hint.innerHTML = `<strong>💡 Hint:</strong> ${message}`;
            hint.style.position = 'fixed';
            hint.style.top = '20px';
            hint.style.right = '20px';
            hint.style.zIndex = '1000';
            hint.style.maxWidth = '300px';
            document.body.appendChild(hint);
            
            setTimeout(() => hint.remove(), 5000);
        }
        
        // Initialize
        window.addEventListener('load', () => {
            createSubstitutionGrid();
            analyzeFrequency();
            
            // Check if already solved
            if (localStorage.getItem('cipherPuzzleSolved') === 'true') {
                const resultDiv = document.getElementById('result-message');
                resultDiv.className = 'result-message success';
                resultDiv.innerHTML = `
                    <h3>✅ Previously Solved</h3>
                    <div class="time-reveal">23:47</div>
                    <p>You have already decrypted Dr. Chen's journal. The time evidence (23:47) has been recorded.</p>
                `;
            }
            
            // Provide subtle hint after 30 seconds
            setTimeout(() => {
                if (!localStorage.getItem('cipherPuzzleSolved')) {
                    showHint("Try using 'O' as a keyword cipher first, then apply a Caesar shift...");
                }
            }, 30000);
        });
        
        // Auto-save workspace
        document.getElementById('workspace').addEventListener('input', (e) => {
            currentWorkspace = e.target.value;
        });
    </script>
</body>
</html>
